
<!DOCTYPE html>
<html>
  <head>
    <title>Experiments</title>
  </head>
  <body>
  <canvas id="pie" width="400" height="200" style="border:1px solid">
    <!-- <script src="file:///Users/spatel78745/js1k/bb.js"></script> -->
  </canvas>

  <script>

  function Wedge(canvasId, x, y, radius, sAngle, eAngle, color) {
    this.ctx = document.getElementById(canvasId).getContext("2d");
    this.x = x;
    this.y = y;
    this.radius = radius;
    this.sAngle = sAngle;
    this.eAngle = eAngle;


    this.draw = function() {

      function rad_to_deg(rad) { return 180 / Math.PI * rad; }

      console.log("draw: x= " + x + " y= " + y + " sAngle= " + rad_to_deg(sAngle) + " eAngle= " 
          + rad_to_deg(eAngle) + " diff: " + rad_to_deg(eAngle - sAngle) + " color= " + color);

      this.ctx.fillStyle = color;
      this.ctx.beginPath();
      this.ctx.moveTo(x, y);
      this.ctx.arc(this.x, this.y, this.radius, this.sAngle, this.eAngle);
      this.ctx.closePath();
      this.ctx.fill();
    }
  }

  function PieChart(canvasId, x, y, radius) {
    this.canvasId = canvasId;
    this.wedges = [];
    this.x = x;
    this.y = y;
    this.radius = radius;

    this.idx = 0;
    this.colors = new Array("DarkGreen", "DarkKhaki", "DarkMagenta", "DarkOrange", "DarkRed",
        "DarkSalmon");

    this.addWedge = function(fraction) {
      var wedges = this.wedges;
      var idx = this.idx;

      var sAngle;
      var eAngle;

      if (idx == 0) {
        sAngle = 0;
      } else {
        var lastWedge = wedges[idx - 1];
        sAngle = lastWedge.eAngle;
      }

      eAngle = sAngle + fraction*2*Math.PI;

      wedges[idx] = new Wedge(this.canvasId, this.x, this.y, this.radius, sAngle, eAngle, this.colors[idx]);

      this.idx++;
    }

    this.draw = function() {
      var wedges = this.wedges;
      var i;

      for(i = 0; i < wedges.length; i++) {
        wedges[i].draw();
      }
    }
  }

  var pieChart = new PieChart("pie", 100, 100, 100);
  pieChart.addWedge("0.30");
  pieChart.addWedge("0.10");
  pieChart.addWedge("0.60");
  pieChart.draw();

  </script>
  </body>
</html>
